// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// RUN: %clang_cc1 -O2 -triple x86_64 -fbounds-safety -emit-llvm %s -o - | FileCheck %s

#include <ptrcheck.h>

struct Foo {
    int len;
    int *__counted_by(len) ptr;
};

// CHECK-LABEL: @TestOOB(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    tail call void @llvm.ubsantrap{{.*}}
// CHECK-NEXT:    unreachable
//
void TestOOB() {
    int arr[10];
    struct Foo f;
    int n = 12;
    f.len = n;
    f.ptr = arr;
}

// CHECK-LABEL: @TestIB(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    ret void
//
void TestIB() {
    int arr[10];
    struct Foo f;
    f.len = 10;
    f.ptr = arr;
}
